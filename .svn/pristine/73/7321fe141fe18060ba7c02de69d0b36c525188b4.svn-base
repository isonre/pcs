<%@ page pageEncoding="UTF-8" contentType="text/html;charset=UTF-8"%>
<%@ include file="/WEB-INF/jsp/common/taglibs.jsp"%>
<c:set var="ctx" value="${pageContext.request.contextPath}"></c:set>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>我的任务</title>
<!-- <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="bootstrap/css/bootstrap-theme.css" rel="stylesheet"> -->


<script src="${ctx}/assets/jquery/ui/jquery-ui.custom.min.js"></script>
<script src="${ctx}/assets/jquery/plugins/jquery-form/jquery-form.min.js"></script>
<script src="${ctx}/assets/jquery/plugins/validation/jquery.validate.min.js"></script>
<script src="${ctx}/assets/jquery/plugins/validation/localization/messages_zh.min.js"></script>
<script src="${ctx}/assets/bootstrap/plugins/date-time/bootstrap-datepicker.min.js"></script>
<script src="${ctx}/assets/bootstrap/plugins/date-time/locales/bootstrap-datepicker.zh-CN.js"></script>
<script src="${ctx}/assets/bootstrap/plugins/bootbox/bootbox.min.js"></script>
<script src="${ctx}/assets/jquery/plugins/jqGrid/js/jquery.jqGrid.min.js"></script>
<script src="${ctx}/assets/jquery/plugins/jqGrid/js/i18n/grid.locale-cn.js"></script>
<script src="${ctx}/assets/jquery/plugins/lixi_common/ajax_render.js"></script>
<script src="${ctx}/assets/jquery/plugins/lixi_common/jquery.serialize-object.min.js"></script>
<script src="${ctx}/assets/jquery/plugins/toast/jquery.toaster.js"></script>
<script src="${ctx}/assets/jquery/plugins/lixi_common/utils.js"></script>
<script src="${ctx}/assets/jquery/plugins/jstree/jstree.min.js"></script>
<script src="${ctx}/assets/jquery/plugins/lixi_common/js-table.js"></script>
<script src="${ctx}/assets/js/agrims.js"></script>
<script>
	function viewTaskMain(id) {
// 		alert(id);
		reloadTaskDetailPage(id);
// 		window.location.href = "${ctx}/dataReoprtedDetail/manager";
	}
</script>



</head>
<body>
	<div class="row" style="background: #fff;">
		<div class="left_content" style="width: 830px; float: left;">
			<!-- <div class="" id="search_content"
				style="height: 60px; border-bottom: 0px solid green;">

			</div> -->
			<div id="task_content" style="margin-top: 10px;">
				<header>
					<div id="fdw-pricing-table">
						<div class="container-fluid" style="width:780px">
							<div class="row">
						      <div class="widget-box">
						      	<table class="zebra" style="width: 100%" style="border-bottom:none">
									<thead>
										<tr>
											<th style="border-bottom:none" align="center"><div style="width:100%;text-align:center;">任务列表</div></th>
										</tr>
									</thead>
								</table>
									<table class="table table-striped table-bordered table-hover js-table fix-table" style="width: 100%" id="takMainTable">
								        <thead>
								          <tr>
								           <th class="text-center" style="">任务名</th>
								           <th class="text-center" style="width: 100px;">期数</th>
								           <th class="text-center" style="width: 100px;text-align: center;">执行类型</th>
<!-- 								           <th class="text-center" style="width: 80px;" >状态</th> -->
								           <th class="text-center" style="width: 80px;">填报</th>
								          </tr>
								         </thead>
								        <tbody>
								        </tbody>
								      </table>
						      
						      </div>
							</div>
						  </div>
  
  

					</div>
				</header>
			</div>
		</div>
		<div class="right_content"
			style="background:; width: 340px; float: left; height: 100%">
			<div id="message_content" style="margin-top: 10px; background: ;">
				<!-- <div class="labelBar"
					style="height: 40px; width: 100%; line-height: 40px;">农产品价格K线图</div>
				<div> -->
				<table class="zebra" style="width: 100%">
							<thead>
								<tr>
									<th>我的信息</th>
								
								</tr>
							</thead>
							<tr>

								<td>任务到期提醒，您有${total}个任务填报中！</td>
								
							</table>
				</div>
			</div>
		</div>
		<script>

		function ajaxRenderTable(url, template){
	          $('#takMainTable').jstable('set_params',{ url: url,template:template});
	        }
		
        function genRowTemplate(node) {
          var tamplate = '<tr id="{id}" class="data-row">' +
                           '\
                            <td title="{taskName}" class="row-select"style=";cursor: pointer;">{taskName}</td>\
                            <td title="{period}">{period}</td>\
                            <td title="{executeType}" style="text-align: center;"> {executeType}</td>\
                            <td title="填报" onclick="viewTaskMain(' + '\'{id}\'' + ')" style="text-align: center;cursor: pointer;" >\
                            <a class="blue" name="view"><i class="ace-icon fa fa-pencil-square-o bigger-150"></i></a>\
                            </td>\
                          </tr>';
          return tamplate;
        }
        
        function reloadTakMainTable(){
            ajaxRenderTable('${ctx}/collect/dataReoprtedMain/myTask/list',genRowTemplate());
            //清空takDetailTable表
           $('#taskDetailTable').data('tmId', null);
           $('#dcpContainer').html('');
          }
			$(function() {
				$("[data-toggle='tooltip']").tooltip({
					html : true
				});
				
				$('#takMainTable').jstable({pager:true,template:genRowTemplate()});
      	        reloadTakMainTable();
			});
			
			$('.taskEditBtn').on('click',  function() {
				var tm_set = $(this);
				reloadTaskDetailPage(tm_set.attr('id'));
			});
			
			function reloadTaskDetailPage(dmId) {
				var url = '${ctx}/main#page/collect/dataReoprtedDetail/manager?dmId=' + dmId;
				loadPage(url);
			}
		</script>
</body>
</html>